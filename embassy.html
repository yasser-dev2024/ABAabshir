<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø³ÙØ§Ø±Ø©</title>

    <link rel="stylesheet" href="libs/tailwind.css" />
    <link rel="stylesheet" href="style.css" />

    <style>
        body, html {
            overflow: hidden;
            height: 100%;
        }

        .page-wrapper {
            height: 100vh;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 120px;
        }

        /* ===== ØªÙ… ØªØµØºÙŠØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø§Ù„Ù…Ø³Ø§Ø³ Ø¨Ø£ÙŠ Ø´ÙŠØ¡ ===== */
        #signVideoBox {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 200px;      /* âœ” Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¹Ø±Ø¶ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
            height: 120px;     /* âœ” Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„ØµØºÙŠØ± */
            background: rgba(0,0,0,0.45);
            border-radius: 15px;
            backdrop-filter: blur(6px);
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999999;
            overflow: hidden;
        }

        #signVideoBox video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }
    </style>
</head>

<body class="font-[Cairo]">

    <!-- ===== Ù†Ø§ÙØ°Ø© Ù…ØªØ±Ø¬Ù… Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (ØµØºÙŠØ±Ø© ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª) ===== -->
    <div id="signVideoBox">
        <video id="signVideo" autoplay muted playsinline></video>
    </div>

    <!-- ===== ØµÙØ­Ø© ÙƒØ§Ù…Ù„Ø© ===== -->
    <div class="page-wrapper">

        <h2 class="text-center text-xl font-bold text-green-700 mb-4">
            Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø³ÙØ§Ø±Ø©
        </h2>

        <div class="space-y-5">

            <!-- ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
            <div>
                <label class="font-bold text-gray-700">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                <button onclick="detectLocation()" 
                    class="w-full bg-blue-600 text-white mt-2 py-3 rounded-xl font-bold shadow hover:bg-blue-700">
                    ØªØ­Ø¯ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ø¨Ø± Google Map
                </button>
                <p id="locationStatus" class="text-sm text-gray-600 mt-1"></p>
            </div>

            <!-- Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù„Ø§Øº -->
            <div>
                <label class="font-bold text-gray-700">Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù„Ø§Øº</label>
                <select id="reportType" class="w-full mt-2 p-3 rounded-xl shadow border bg-white">
                    <option selected disabled>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù„Ø§Øº</option>
                    <option>Ø¨Ù„Ø§Øº Ø£Ù…Ù†ÙŠ</option>
                    <option>Ø¨Ù„Ø§Øº Ø·Ø§Ø±Ø¦</option>
                    <option>ÙÙ‚Ø¯Ø§Ù† Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±</option>
                    <option>Ø·Ù„Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ø¬Ù„Ø©</option>
                    <option>Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ø§Ù…</option>
                </select>
            </div>

            <!-- ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© -->
            <div>
                <label class="font-bold text-gray-700">ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø©</label>
                <textarea id="details" rows="4"
                    class="w-full mt-2 p-3 rounded-xl shadow border bg-white"
                    placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§Øº Ù‡Ù†Ø§..."></textarea>
            </div>

            <!-- Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù -->
            <div>
                <label class="font-bold text-gray-700">Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù Ø£Ùˆ ØµÙˆØ±Ø©</label>
                <input type="file" id="attachment"
                       class="w-full mt-2 p-3 rounded-xl shadow border bg-white">
            </div>

            <!-- ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ -->
            <button onclick="startEmergencyVideo()"
                class="w-full bg-red-600 text-white py-3 rounded-xl font-bold shadow hover:bg-red-700">
                ØªØ´ØºÙŠÙ„ ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ (ÙŠØ³Ø¬Ù‘Ù„ 15 Ø«Ø§Ù†ÙŠØ©)
            </button>

            <video id="preview" class="w-full rounded-xl hidden mt-3"></video>

            <!-- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº -->
            <button id="sendBtn" onclick="sendForm()"
                class="w-full bg-green-700 text-white py-4 rounded-xl text-lg font-bold shadow hover:bg-green-800">
                Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº
            </button>

            <!-- Ø§Ù„Ø¹ÙˆØ¯Ø© -->
            <a href="index.html"
                class="block text-center bg-gray-300 text-gray-800 py-4 rounded-xl text-lg font-bold shadow hover:bg-gray-400">
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </a>
        </div>
    </div>

    <!-- ========== Ø³ÙƒØ±Ø¨ØªØ§Øª ========== -->
    <script>

        function detectLocation() {

            if (!navigator.geolocation) {
                locationStatus.textContent = "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.";
                return;
            }

            locationStatus.textContent = "Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒâ€¦";

            navigator.geolocation.getCurrentPosition(async (position) => {

                let lat = position.coords.latitude;
                let lng = position.coords.longitude;

                try {
                    let url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`;

                    let res = await fetch(url);
                    let data = await res.json();

                    let country = data.address.country || "";
                    let city = data.address.city || data.address.town || data.address.village || "";

                    locationStatus.textContent = `Ø£Ù†Øª ÙÙŠ ${country} â€“ ${city}`;

                } 
                catch {
                    locationStatus.textContent = "ØªØ¹Ø°Ù‘Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.";
                }

            }, () => {
                locationStatus.textContent = "ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.";
            });
        }

        let autoSendTimer;

        function startEmergencyVideo() {
            let video = document.getElementById("preview");
            let fileInput = document.getElementById("attachment");

            navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                .then(async (stream) => {

                    video.srcObject = stream;
                    video.classList.remove("hidden");
                    video.play();

                    let recorder = new MediaRecorder(stream);
                    let chunks = [];

                    recorder.ondataavailable = e => chunks.push(e.data);

                    recorder.onstop = () => {

                        let blob = new Blob(chunks, { type: "video/mp4" });
                        let file = new File([blob], "emergency.mp4", { type: "video/mp4" });

                        let dt = new DataTransfer();
                        dt.items.add(file);
                        fileInput.files = dt.files;

                        video.classList.add("hidden");

                        alert("ğŸ¥ ØªÙ… ØªØ³Ø¬ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆØ¥Ø±ÙØ§Ù‚Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹!");

                        autoSendTimer = setTimeout(() => {
                            sendForm();
                        }, 10000);
                    };

                    recorder.start();

                    setTimeout(() => {
                        recorder.stop();
                        stream.getTracks().forEach(t => t.stop());
                    }, 15000);
                })
                .catch(() => alert("ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§!"));
        }

        function sendForm() {
            clearTimeout(autoSendTimer);
            alert("âœ” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙØ§Ø±Ø©.");
        }
    </script>

    <script src="smart-access.js"></script>

    <script>
        const signDictionary = {
            "Ø§Ù„Ø³ÙØ§Ø±Ø©": "ğŸ¤Ÿ Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø³ÙØ§Ø±Ø©",
            "ØªØ­Ø¯ÙŠØ¯": "ğŸ‘‰",
            "Ù…ÙˆÙ‚Ø¹": "ğŸ‘‡",
            "Ø¨Ù„Ø§Øº": "âœ‹ Ø¨Ù„Ø§Øº",
            "Ø£Ù…Ù†ÙŠ": "âœŠ Ø£Ù…Ù†ÙŠ",
            "Ø·Ø§Ø±Ø¦": "ğŸš¨",
            "Ù…Ø³Ø§Ø¹Ø¯Ø©": "ğŸ‘ Ù…Ø³Ø§Ø¹Ø¯Ø©",
            "Ø¬ÙˆØ§Ø²": "ğŸ“˜",
            "Ø³ÙØ±": "âœˆï¸",
            "Ø¥Ø±Ø³Ø§Ù„": "ğŸ“¤",
            "Ø¹ÙˆØ¯Ø©": "â†©ï¸",
            "Ù…Ù„Ù": "ğŸ“„",
            "ØµÙˆØ±Ø©": "ğŸ“·",
            "ÙÙŠØ¯ÙŠÙˆ": "ğŸ¥",
            "Ø§Ù„Ø¥Ø´Ø§Ø±Ø©": "âœ‹",
            "Ù‚Ø±Ø§Ø¡Ø©": "ğŸ‘‚",
            "Ù†Øµ": "ğŸ“˜"
        };

        document.addEventListener("mouseover", function (e) {
            let text = e.target.innerText.trim();
            if (text.length === 0) return;

            window.speechSynthesis.cancel();

            const speak = new SpeechSynthesisUtterance(text);
            speak.lang = "ar-SA";
            speak.rate = 1.05;
            window.speechSynthesis.speak(speak);
        });
    </script>

    <script>
        const signVideo = document.getElementById("signVideo");

        const videos = [
            "assets/videos/11.mp4",
            "assets/videos/22.mp4"
        ];

        let currentVideo = 0;

        function playNextVideo() {
            signVideo.src = videos[currentVideo];
            signVideo.play();
            currentVideo = (currentVideo + 1) % videos.length;
        }

        signVideo.addEventListener("ended", playNextVideo);
        playNextVideo();
    </script>

</body>
</html>
